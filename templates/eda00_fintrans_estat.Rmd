---
title: "Eurostat Financial Transactions"
subtitle: "EDA"
author: "Oliver Hauke"
date: "2023-01-16"
output: 
  html_document:
    code_folding: hide
---

## Prerequisites


```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>"
)

opts_chunk$set(cache = TRUE) # for perfomance and reusing plots etc
options(tidyverse.quiet = TRUE)

library(tidyverse)
library(ggplot2)
library(inspectdf)

show_tab = function(dat, digits = 2) {dat %>%
    mutate(across(where(is.numeric),
                .fns = ~round(.x, digits = digits))
           ) %>%
    DT::datatable(filter = 'top')
  }
```


### Load the Data

```{r pre-input, class.source = "fold-show"}
#online or locally
#dat <- eurostat::get_eurostat("nasq_10_f_tr")
dat <- "../../../data/eurostat/nasq_10_f_tr_23-01-14.qs" %>%
  here::here() %>% qs::qread()
```


### Tidy the Data

```{r pre-tidy}
dat <- dat %>% 
  mutate(across(where(is_character),as_factor)) %>%
  filter(unit == "MIO_EUR") %>% select(-"unit")
```


## Explainatory Data Analysis

See [R for Data Science#7 Explainatory Data Analysis](https://r4ds.had.co.nz/exploratory-data-analysis.html).

### Overview

```{r ov-skim}
skimr::skim(dat)
#or dplyr::glimpse(dat)
```
- almost complete, only 1.4% of "values" is missing.
- "value" is available for 3 units, so select "Mio Euro".

#### Types

```{r ov-types}

if(length(dat) <= 10){
  inspect_types(dat) %>% show_plot()
} else {inspect_types(dat) %>% show_tab()}

```

#### Memory

```{r ov-mem}
inspect_mem(dat) %>% select(-bytes) %>% show_tab()
```


### Variation

#### Numeric Variables

tba: https://alastairrushworth.github.io/inspectdf/articles/pkgdown/inspect_num_examples.html

#### Categorical Variables

```{r var-cat}
var_cat = inspect_cat(dat)
var_cat %>% show_tab()
```

```{r var-cat-plot}
var_cat %>% show_plot()
```

- uniformly distributed

##### Balanceness

```{r var-cat_bal}
inspect_imb(dat) %>% show_plot()
```
- No imbalances

### Missingness

tba: https://alastairrushworth.github.io/inspectdf/articles/pkgdown/inspect_na_examples.html

### Covariation

tba, s. [inspectdf#correlation](https://alastairrushworth.github.io/inspectdf/articles/pkgdown/inspect_cor_exampes.html) or using [DataExplorer::plot_correlation](https://cran.r-project.org/web/packages/DataExplorer/vignettes/dataexplorer-intro.html):

```{r cov-heatmap}
DataExplorer::plot_correlation(na.omit(dat), maxcat = 30L) # maxcat = 30L
```

